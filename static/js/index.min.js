!function (n) { "use strict"; var a = !1; n('a.js-scroll-trigger[href*="#"]:not([href="#"])').click(function () { if (location.pathname.replace(/^\//, "") == this.pathname.replace(/^\//, "") && location.hostname == this.hostname) { var a = n(this.hash); if ((a = a.length ? a : n("[name=" + this.hash.slice(1) + "]")).length) return n("html, body").animate({ scrollTop: a.offset().top - 54 }, 1e3, "easeInOutExpo"), !1 } }), n(".modal").on("shown.bs.modal", function (a) { n(".img-slider").resize() }), n(".js-scroll-trigger").click(function () { n(".navbar-collapse").collapse("hide") }), n("body").on("hidden.bs.modal", function () { 0 < n(".modal.in").length && n("body").addClass("modal-open") }), n(document).ready(function () { n(".modal").on("hidden.bs.modal", function (a) { n(".modal:visible").length && n("body").addClass("modal-open") }) }), n(document).ready(function () { n(document).on("show.bs.modal", ".modal", function (a) { var o = 1040 + 10 * n(".modal:visible").length; n(this).css("z-index", o), setTimeout(function () { n(".modal-backdrop").not(".modal-stack").css("z-index", o - 1).addClass("modal-stack") }, 0) }) }), n(".img-slider").slick("setPosition"), n("body").scrollspy({ target: "#mainNav", offset: 56 }); var o = function () { a = 250 < n(window).scrollTop() ? (a || n(".navbar").hide(), n("#mainNav").addClass("navbar-shrink"), n("#logo").addClass("logo-shrink"), n("#mainNav").removeClass("top"), n("#mainNav").addClass("fixed-top"), n(".navbar").fadeIn(300), !0) : (n("#mainNav").removeClass("navbar-shrink"), n("#logo").removeClass("logo-shrink"), n("#mainNav").removeClass("fixed-top"), n("#mainNav").addClass("top"), n(".navbar").show(), !1) }; n("#navbar-btn").click(function () { document.getElementById("mainNav").classList.contains("black-on-show") ? n("#mainNav").removeClass("black-on-show") : n("#mainNav").addClass("black-on-show") }), o(), n(window).scroll(o), n(".portfolio-modal").on("show.bs.modal", function (a) { n(".navbar").addClass("d-none") }), n(".portfolio-modal").on("hidden.bs.modal", function (a) { n(".navbar").removeClass("d-none") }); var s, e; s = { lat: -23.4960314, lng: 46.8878587 }, e = new google.maps.Map(document.getElementById("map"), { zoom: 17, center: s }), new google.maps.Marker({ position: s, map: e }) }(jQuery);

//função executada ao carregar a página, contém as funções que vão carregar os produtos e modais.
window.onload = function () {
    var produtos = get('/produtos');
    produtos = JSON.parse(produtos);
    console.log(produtos);
    for (produto in produtos) {
        this.addProduto(produtos[produto]);
        this.addModalProduto(produtos[produto]);
    }
    var aplicacoes = get('/aplicacoes');
    aplicacoes = JSON.parse(aplicacoes);
    for (aplicacao in aplicacoes) {
        this.addAplicacao(aplicacoes[aplicacao]);
        this.addModalAplicacao(aplicacoes[aplicacao]);
    }
};

//função responsável por fazer qualquer requisição GET ao banco de dados
function get(theUrl) {
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.open("GET", theUrl, false); // false for synchronous request
    xmlHttp.send(null);
    return xmlHttp.responseText;
}

//adiciona cada produto na tela
function addProduto(produto) {
    div = document.createElement('div');
    div.className = 'col-md-4 col-sm-6 vidros-item';
    div.id = produto.id

    div.innerHTML = `
        <a class="vidros-link" data-toggle="modal" href="#produtoModal`+ produto.id + `">
            <div class="vidros-hover">
                <div class="vidros-hover-content">
                    <i class="fas fa-search-plus fa-3x"></i>
                </div>
            </div>
            <img class="img-fluid fit-image" src="`+ produto.imagem + `" alt="">
        </a>
        <div class="vidros-caption">
            <h4>`+ produto.titulo + `</h4>
        </div>
        
    `;

    document.getElementById('getProdutos').appendChild(div);
}

//cada produto abre um modal que contém várias imagens, essa função adiciona o modal de cada produto
function addModalProduto(produto) {
    const div = document.createElement('div');
    div.innerHTML = `
    <div class="vidros-modal modal fade" id="produtoModal`+ produto.id + `" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="close-modal" data-dismiss="modal">
            <i class="fas fa-times externo"></i>
        </div>
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="container">
                    <div class="modal-body modal-reduce-width">
                        <h2 class="text-uppercase">`+ produto.titulo + `</h2>
                        <img class="img-fluid d-block mx-auto vidros-moldura" src="`+ produto.imagem + `" alt="">
                        <p>`+ produto.texto + `</p>
                        <button class="btn btn-primary" data-dismiss="modal" type="button">
                            <i class="fas fa-times"></i>
                            Fechar</button>
                    </div>

                </div>
            </div>
        </div>
    </div>
    `
    document.getElementById('getModal').appendChild(div);
}

//adiciona cada aplicação na tela
function addAplicacao(aplicacao) {
    div = document.createElement('div');
    div.id = aplicacao.id;
    div.innerHTML = `
    <div class="zoom">
        <a a class="vidros-link" data-toggle="modal" href="#modalaplicacoes`+ aplicacao.id + `">
            <div class="img-fluid imgSlider" style="background-image: url(`+ aplicacao.imagem + `)">
                <h4 class="texto-produtos">` + aplicacao.nome + `</h4 class="texto-produtos">
            </div>
        </a>
    </div>
    `
        ;

    document.getElementById('getAplicacoes').appendChild(div);
}

//cada aplicação abre um modal que contém várias imagens, essa função adiciona o modal de cada aplicação
function addModalAplicacao(aplicacao) {
    div = document.createElement('div');
    varhtml = `
    <div class="vidros-modal modal fade" id="modalaplicacoes`+ aplicacao.id + `" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="close-modal" data-dismiss="modal">
            <i class="fas fa-times externo"></i>
        </div>
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="container small-modal-container">
                    <div class="modal-body">
                    <div id="top`+ aplicacao.id + `">
                        <div class="row" id="rm1`+ aplicacao.id + `">
                        </div>
                        <div class="row text-center" id="rm2`+ aplicacao.id + `">
                            <h2 id="titulo" class="text-uppercase text-center w-100">`+ aplicacao.nome + `</h2>
                        </div>
                    </div>
                        <div class="container">
                            <div class="row justify-content-center" id="getImagens`+ aplicacao.id + `">
                                `+ addImagens(aplicacao.id) + `
                            </div>
                        </div>

                        <button class="btn btn-primary" data-dismiss="modal" type="button">
                            <i class="fas fa-times"></i>
                            Fechar</button>
                    </div>

                </div>
            </div>
        </div>
    </div>
    

    

    `
    div.innerHTML = varhtml;
    document.getElementById('getModal').appendChild(div);

    titulo = document.getElementById('titulo').innerHTML
}

//adiciona as imagens dentro de cada modal
function addImagens(id) {
    var imagens = get('/imagens_aplicacoes/0/' + id);
    imagens = JSON.parse(imagens);
    console.log(imagens);
    var html = '';
    for (imagem in imagens) {
        console.log(imagens[imagem]);
        html += `
        <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12 vidros-item" style="margin-bottom: 10px" id="`+ imagens[imagem].id + `">
            <a class="open-img fill" data-toggle="modal" href="#imgModal`+ imagens[imagem].id + `"><img class="img-produtos img-fluid" src="` + imagens[imagem].imagem + `" alt=""></a>
            <div id="expand`+ imagens[imagem].id + `" class="collapse" style="">
        </div>
        </div>
        `;
        this.addModalImagem(imagens[imagem]);
    }
    return html;
}

//dentro do modal, cada imagem possui um outro modal que a exibe de forma ampliada, essa função os cria
function addModalImagem(imagem) {
    div2 = document.createElement('div');
    div2.innerHTML = `
    <div class="vidros-modal img-modal modal fade" id="imgModal`+ imagem.id + `" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
        aria-hidden="true">
        <div class="close-modal" data-dismiss="modal">
            <i class="fas fa-times externo"></i>
        </div>
        <div class="modal-dialog">
            <div class="modal-body">
                <div class="row justify-content-center">
                <span class="height-ajust"></span><img class="img-open-modal" src="`+ imagem.imagem + `">
                </div>
            </div>
        </div>
    </div>
    `;

    document.getElementById('getModal').appendChild(div2);
}
